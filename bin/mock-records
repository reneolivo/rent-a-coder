#!/usr/bin/env node

var async		= require( 'async' );
var coders		= require( '../models/db' )( 'rent-a-coder' );
var accounts	= require( '../models/db' )( 'accounts' );

var records		= require( '../data/mock-data' );



var toProcess	= [];
for(var i in records) {
	toProcess.push((function(record) {
		return function(asyncCallback) {
			coders.insert( record, asyncCallback );
		}
	})( records[ i ] ));
}

//DELETES all records
async.waterfall([
	function(next) {
		accounts.remove( {}, { multi: true }, next );
	},
	function(removed, next) {
		coders.remove({}, { multi: true }, next);
	}
], function(err, result) {
	if (err) {
		return console.error( err );
	}

	//INSERTS mock records
	async.parallel(toProcess, function(err, result) {
		if (err) {
			return console.error( err );
		}

		console.log( '-mocks installed-' );
	});
});